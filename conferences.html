<!DOCTYPE html>
<html>
    <head>
        <script src="conferences.js"></script>
    </head>
    <body>
        <div id="dashboard"></div>

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />

        <script src="https://unpkg.com/react/umd/react.production.min.js"></script>
        <script src="https://unpkg.com/react-dom/umd/react-dom.production.min.js"></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

        <script>
            function fetchMeetingRooms() {
                return fetch('/getRooms') 
                    .then(response => response.json())
                    .then(data => data.roomsList)
                    .catch(error => console.error('Error:', error));
            }
        </script>

        <script type="text/babel">
            function Room({ room, toggleRoomStatus }) {
                const { roomId, isEmpty, participants, startDate, endDate, roomCapacity } = room;

                return (
                    <div
                        className={`card text-white ${isEmpty ? "bg-danger" : "bg-success"} mb-3`} // set color based on room status
                        style={{ maxWidth: "18rem", minHeight: "18rem" }}
                    >
                        <div className="card-header">Oda #{roomId}</div>
                        <div className="card-body">
                            {!isEmpty && (
                                <>
                                    <h5 className="card-title">Toplantı Bilgileri</h5>
                                    <p className="card-text">Katılımcılar: {participants.join(', ')}</p>
                                    <p className="card-text">Başlangıç tarihi: {formatDate(startDate)}</p>
                                    <p className="card-text">Bitiş tarihi: {formatDate(endDate)}</p>
                                </>
                            )}
                            <p className="card-text">Kapasite: {roomCapacity}</p>
                        </div>
                    </div>
                );
            }

            function formatDate(date) {
                return new Date(date).toLocaleDateString() + ' ' + new Date(date).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            }

            function Dashboard() {
                const [rooms, setRooms] = React.useState([]);

                React.useEffect(() => {
                    fetchMeetingRooms().then((data) => {
                        setRooms(data);
                    });
                }, []);

                const toggleRoomStatus = (roomId) => {
                    setRooms((prevRooms) =>
                        prevRooms.map((room) =>
                            room.id === roomId ? { ...room, isEmpty: !room.isEmpty } : room
                        )
                    );
                };

                const addRoom = () => {
                    setRooms((prevRooms) => [
                        ...prevRooms,
                        {
                            id: prevRooms.length + 1,
                            isEmpty: true,
                            participants: [],
                            startDate: null,
                            endDate: null,
                            capacity: 10
                        },
                    ]);
                };

                return (
                    <div className="container mt-3">
                        <button className="btn btn-primary mb-3" onClick={addRoom}>Oda Ekle</button>
                        <div className="row">
                            {rooms.map(room => (
                                <div className="col-md-4">
                                    <Room key={room.id} room={room} toggleRoomStatus={toggleRoomStatus} />
                                </div>
                            ))}
                        </div>
                    </div>
                );
            }

            ReactDOM.render(<Dashboard />, document.getElementById('dashboard'));
        </script>
    </body>

</html>
