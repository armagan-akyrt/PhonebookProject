<!DOCTYPE html>
<html>

    <head>
        <title>Konferanslar</title>
    </head>

    <body>
        <div id="navbar-root"></div>
        <div id="app-root"></div>
        <div id="dashboard"></div>


        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />

        <script src="https://unpkg.com/react/umd/react.production.min.js"></script>
        <script src="https://unpkg.com/react-dom/umd/react-dom.production.min.js"></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
        

        <script type="text/babel">
            function Navbar() {
                return (
                    <nav className="navbar navbar-expand-lg navbar-light bg-light">
                        <a className="navbar-brand" href="/index.html">Konferanslar</a>
                        <button className="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                            <span className="navbar-toggler-icon"></span>
                        </button>
                        <div className="collapse navbar-collapse" id="navbarNavDropdown">
                            <ul className="navbar-nav">
                                <li className="nav-item active">
                                    <a className="nav-link" href="/index.html">Ana Sayfa <span className="sr-only">(current)</span></a>
                                </li>
                                <ul className="nav-item dropdown">
                                    <a className="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Kullanıcı
                                    </a>
                                    <div className="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                        <a className="dropdown-item" href="/userpage.html">Kullanıcı Sayfası</a>
 
                                    </div>
                                </ul>
                                <a className="nav-link" href="/adminPage.html" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Yönetici
                                </a>
                            </ul>
                            
                        </div>
                    </nav>
                );
            }
        
            ReactDOM.render(<Navbar />, document.getElementById('navbar-root'));
        </script>

        <script>
            function fetchMeetingRooms() {
                return fetch('/getRooms')
                    .then(response => response.json())
                    .then(data => data.roomsList)
                    .catch(error => console.error('Error:', error));
            }
        </script>

        <script type="text/babel">
            function deleteRoom() {
                // Retrieve the overseerId from sessionStorage
                const overseerId = JSON.parse(sessionStorage.getItem('currentUser')).id;

                // Prompt the user for the room capacity
                const roomId = localStorage.getItem('roomId');
                console.log(`roomid: ${roomId}`);

                // Make a POST request to /createRoom
                fetch('/deleteRoom', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ roomId: roomId })
                })
                    .then(response => response.text())
                    .then(data => alert(data))
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }
            function Room({ room, toggleRoomStatus }) {
                const { roomId, isEmpty, participants, startDate, endDate, roomCapacity } = room;

                return (
                    <div
                        className={`card text-white ${isEmpty ? "bg-danger" : "bg-success"} mb-3`} // set color based on room status
                        style={{ maxWidth: "18rem", minHeight: "18rem" }}
                    >
                        <div className="card-header">Oda #{roomId}</div>
                        <div className="card-body">
                            {!isEmpty && (
                                <>
                                    <h5 className="card-title">Toplantı Bilgileri</h5>
                                    <p className="card-text">Katılımcılar: {participants.join(', ')}</p>
                                    <p className="card-text">Başlangıç tarihi: {formatDate(startDate)}</p>
                                    <p className="card-text">Bitiş tarihi: {formatDate(endDate)}</p>
                                </>
                            )}
                            <p className="card-text">Kapasite: {roomCapacity}</p>
                            {localStorage.setItem('roomId', roomId)}
                            <button className="btn btn-primary mb-1" onClick={deleteRoom}>Sil</button>
                        </div>
                    </div>
                );
            }

            function formatDate(date) {
                return new Date(date).toLocaleDateString() + ' ' + new Date(date).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            }

            function Dashboard() {
                const [rooms, setRooms] = React.useState([]);

                React.useEffect(() => {
                    fetchMeetingRooms().then((data) => {
                        setRooms(data);
                    });
                }, []);

                const toggleRoomStatus = (roomId) => {
                    setRooms((prevRooms) =>
                        prevRooms.map((room) =>
                            room.id === roomId ? { ...room, isEmpty: !room.isEmpty } : room
                        )
                    );
                };

                function addRoom() {
                    // Retrieve the overseerId from sessionStorage
                    const overseerId = JSON.parse(sessionStorage.getItem('currentUser')).id;

                    // Prompt the user for the room capacity
                    const roomcapacity = prompt('Enter room capacity:');
                    console.log(`overseerId: ${overseerId}, roomcapacity: ${roomcapacity}`);

                    // Make a POST request to /createRoom
                    fetch('/createRoom', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ overseerId: overseerId, roomCapacity: roomcapacity })
                    })
                        .then(response => response.text())
                        .then(data => alert(data))
                        .catch((error) => {
                            console.error('Error:', error);
                        });
                };
               

                function RoomList({ rooms }) {
                    return (
                        <div>
                            {rooms.map(room => (
                                <div key={room.id}>
                                    <input type="checkbox" id={`room-${room.id}`} />
                                    <label htmlFor={`room-${room.id}`}>{room.name}</label>
                                </div>
                            ))}
                        </div>
                    );
                }
                
                return (
                    <div className="container mt-3">
                        <button className="btn btn-primary mb-3" onClick={addRoom}>Oda Ekle</button>
                        <div className="row">
                            {rooms.map(room => (
                                <div className="col-md-4">
                                    <Room key={room.id} room={room} toggleRoomStatus={toggleRoomStatus} />
                                </div>
                            ))}
                        </div>
                    </div>
                );
            }

            

            ReactDOM.render(<Dashboard />, document.getElementById('dashboard'));
        </script>
    </body>

</html>
