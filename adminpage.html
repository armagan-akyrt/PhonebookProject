<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <script>
        fetch('/userdata')
        .then(response => response.json())
        .then(user => {
            if (user.role !== 'ADMIN') {
                window.location.href = '/index.html';
            }
        });
    </script>

    <ul class = "navbar">
        <li><a href="/index.html">Ana Sayfa</a></li>
        <li>
            <a href="#">Kullanıcı</a>
            <ul class="dropdown">
                <li><a href="/userpage.html">Kullanıcı Görünümü</a></li>
                <li><a href="/createNewUser.html?isAdmin=true">Yeni Kullanıcı Oluştur</a></li>
            </ul>
        </li>


    </ul>

    <div class="flex-container">
        <div class="left-container">
            <input type="text" id="searchInputUser" name = "searchInputUser" onkeyup="filterList()" placeholder="Kullanıcı araması...">
            <div class = "scrollable-list">
                <ul id="listToShowUser">
                    <!-- List items will be populated dynamically here -->
                </ul>

            </div>
    
        </div>
        <div class="centre-container1">
            <h2>Kullanıcı Bilgileri</h2>
            <form action="/updateUser" method="POST">
                <label for="name"><b>Ad</b></label>
                <input type="text" name="name" required>

                <label for="surname"><b>Soyad</b></label>
                <input type="text" name="surname" required>

                <label for="gsmNum"> Telefon Numarası</label>
                <input type="text" name="gsmNum" required>


                <label for="email"><b>Email</b></label>
                <input type="text" name="email" required>
                
                <label for="address"><b>Adres</b></label>
                <textarea name="address" id="address" rows="4" class="address-input"></textarea>


                <button type="submit" style="margin-top: 10px;" name="updateUserButton" id="updateUserButton">Güncelle</button>
                <button type="button" style="margin-top: 10px;" name="deleteUserButton" id="deleteUserButton">Sil</button>
            </form>
        </div>
    
        <div class = "centre-container2">
            <input type="text" id="searchInputContact" name="searchInputContact" onkeyup="filterList()" placeholder="Bağlantı araması...">
            <div class = "scrollable-list">
                <ul id="listToShowContact">
                    <!-- List items will be populated dynamically here -->
                </ul>

            </div>
        </div>
        <div class = "right-container">
            <h2>Bağlantı Bilgileri</h2>
            <form action="/updateContact" method="POST">
                <label for="name"><b>Ad</b></label>
                <input type="text" name="contactName" required>

                <label for="surname"><b>Soyad</b></label>
                <input type="text" name="contactSurname" required>

                <label for="gsmNum"> Telefon Numarası</label>
                <input type="text" name="contactGsmNum" required>


                <label for="email"><b>Email</b></label>
                <input type="text" name="contactEmail" required>
                
                <label for="address"><b>Adres</b></label>
                <textarea name="contactAddress" id="address" rows="4" class="address-input"></textarea>


                <button type="submit" style="margin-top: 10px;" name="updateContactButton" id="updateContactButton">Güncelle</button>
                <button type="button" style="margin-top: 10px;" name="deleteContactButton" id="deleteContactButton">Sil</button>
            </form>
        </div>

        <script>

            const User = require ('./Scripts/User');
            let currentUser = new User();

            window.onload = function() {
                let users = []; // This array will store all the user data
                let contacts = []; // This array will store all the contact data

                fetch('/userdata')
                    .then(response => response.json())
                    .then(user => {
                        currentUser = user;
                    });
                
                fetch('/getUsers')
                    .then(response => response.json())
                    .then(data => {
                        users = data.usersList;
                        const listToShowUser = document.getElementById('listToShowUser');
                        users.forEach((user, index) => {
                            const li = document.createElement('li');
                            li.textContent = `${user.name} ${user.surname}`; // Display the user's name and surname
                            li.addEventListener('click', () => fillForm(user)); // When this list item is clicked, fill the form with this user's data
                            listToShowUser.appendChild(li);
                        });
                    })
                    .catch(error => console.error('Error:', error));

                fetch('/getContacts')
                .then(require => require.json())
                .then(response => response.json())
                .then(data => {
                    contacts = data.contactsList;
                    const listToShowContact = document.getElementById('listToShowContact');
                    contacts.forEach((contact, index) => {
                        const li = document.createElement('li');
                        li.textContent = `${contact.name} ${contact.surname}`; // Display the user's name and surname
                        li.addEventListener('click', () => fillContactForm(contact)); // When this list item is clicked, fill the form with this user's data
                        listToShowContact.appendChild(li);
                    });
                });

            }
            
            function fillForm(user) {
                document.getElementsByName('name')[0].value = user.name;
                document.getElementsByName('surname')[0].value = user.surname;
                document.getElementsByName('gsmNum')[0].value = user.phoneNumber;
                document.getElementsByName('email')[0].value = user.email;
                document.getElementsByName('address')[0].value = user.address;
                document.getElementById('updateUserButton').addEventListener('click', (event) => updateUser(event, user));
                document.getElementById('deleteUserButton').addEventListener('click', (event) => deleteUser(event, user));
            }

            function fillContactForm(contact) {
                document.getElementsByName('contactName')[0].value = contact.name;
                document.getElementsByName('contactSurname')[0].value = contact.surname;
                document.getElementsByName('contactGsmNum')[0].value = contact.phoneNumber;
                document.getElementsByName('contactEmail')[0].value = contact.email;
                document.getElementsByName('contactAddress')[0].value = contact.address;
                document.getElementById('updateContactButton').addEventListener('click', (event) => updateUser(event, user));
                document.getElementById('deleteContactButton').addEventListener('click', (event) => deleteUser(event, user));
            }

        </script>

    </div>

    
    
    
</body>
</html>